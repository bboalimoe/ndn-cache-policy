/*
 * jQuery keymap plugin
 * Version 0.1
 *
 * Copyright (c) 2009 Kay-Uwe 'Kiwi' HÃ¼ll <kiwi@franka.dyndns.org>
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 *
 * Basic Keymap Code taken from "JavaScript - The Definitive Guide" Example 17-6.
 */
(function($){var keyCodeToFunctionKey={8:"backspace",9:"tab",13:"return",19:"pause",27:"escape",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:'up',39:'right',40:"down",44:"printscreen",45:"insert",46:"delete",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scrolllock"};var keyCodeToPrintableChar={48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:";",61:"=",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",91:"[",92:"\\",93:"]",96:"`",60:"<",39:"'"};$.getKeyName=function(e){var keyname=null;var modifiers='';if(e.keyCode){keyname=keyCodeToFunctionKey[e.keyCode];if(!keyname)
keyname=keyCodeToPrintableChar[e.keyCode];}
if(e.altKey)modifiers+="alt_";if(e.ctrlKey)modifiers+="ctrl_";if(!keyname){keyname=String.fromCharCode(e.which||e.charCode);}
return modifiers+keyname;}
function _keymapKeyPress(e){var opts=this._keymap;var map=opts.keymap;var r;if(opts.includeTargets&&!$(e.target).is(opts.includeTargets))return;if(opts.excludeTargets&&$(e.target).is(opts.excludeTargets))return;keyname=$.getKeyName(e)
if(map[keyname])
{r=map[keyname].call(map,e);if(typeof r=='undefined'||r){if(opts.preventDefault)e.preventDefault();if(opts.stopPropagation)e.stopImmediatePropagation();}}
else if(map['default'])
{r=map['default'].call(map,e);if(typeof r=='undefined'||r){if(opts.preventDefault)e.preventDefault();if(opts.stopPropagation)e.stopImmediatePropagation();}}}
function _ignore(e)
{var opts=this._keymap;var map=opts.keymap;keyname=$.getKeyName(e);if(map[keyname]||map['default'])
{if(opts.preventDefault)e.preventDefault();if(opts.stopPropagation)e.stopImmediatePropagation();}}
$.fn.keymap=function(map,opts){var webkit=$.browser.webkit;webkit=true;var opts=$.extend({preventDefault:false,stopPropagation:false,ignoreKeyDown:false,ignoreKeyUp:false,includeTargets:'',excludeTargets:'',keymap:map},opts);var element=this.get(0);if(typeof(map)=='undefined')
{var arr=[];this.each(function(){arr.push(this)});return this.pushStack(arr);}
if(map==null||map==false){this.each(function(){var opts=this._keymap;if(webkit)
$(this).unbind('keydown.keymap',_keymapKeyPress);if(opts.ignoreKeyUp)
$(this).unbind('keyup.keymap',_ignore);else{$(this).unbind('keypress.keymap',_keymapKeyPress);if(opts.ignoreKeyDown)
$(this).unbind('keydown.keymap',_ignore);if(opts.ignoreKeyUp)
$(this).unbind('keyup.keymap',_ignore);}
delete this._keymap;});}
else
{this.each(function(){if(this._keymap){if(this._keymap.ignoreKeyUp!=opts.ignoreKeyUp)
{var f=opts.ignoreKeyUp?$(this).bind:$(this).unbind;f('keyup.keymap',_ignore);}
if(!webkit){if(this._keymap.ignoreKeyDown!=opts.ignoreKeyDown)
{var f=opts.ignoreKeyDown?$(this).bind:$(this).unbind;f('keydown.keymap',_ignore);}}
$.extend(opts.keymap,this._keymap.keymap);this._keymap=opts;}
else
{this._keymap=opts;if(webkit){$(this).bind('keydown.keymap',_keymapKeyPress);if(opts.ignoreKeyUp)
$(this).bind('keyup.keymap',_ignore);}else{$(this).bind('keypress.keymap',_keymapKeyPress);if(opts.ignoreKeyUp)
$(this).bind('keyup.keymap',_ignore);if(opts.ignoreKeyDown)
$(this).bind('keydown.keymap',_ignore);}}});}}})(jQuery);